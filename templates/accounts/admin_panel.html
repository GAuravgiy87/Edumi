{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1>Admin Control Panel</h1>
        <a href="{% url 'user_management' %}" class="btn-add-camera"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></span> Manage Users</a>
    </div>
    
    <!-- Statistics Overview -->
    <div class="dashboard-grid">
        <div class="stat-card">
            <div class="stat-icon" style="background: #1877f2;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></span>
            </div>
            <div class="stat-info">
                <h3>Total Users</h3>
                <p class="stat-number">{{ total_users }}</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon" style="background: #31a24c;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg></span>
            </div>
            <div class="stat-info">
                <h3>Students</h3>
                <p class="stat-number">{{ total_students }}</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon" style="background: #f59e0b;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></span>
            </div>
            <div class="stat-info">
                <h3>Teachers</h3>
                <p class="stat-number">{{ total_teachers }}</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon" style="background: #8b5cf6;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></span>
            </div>
            <div class="stat-info">
                <h3>Total Meetings</h3>
                <p class="stat-number">{{ total_meetings }}</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon" style="background: #e4294b;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8"></circle></svg></span>
            </div>
            <div class="stat-info">
                <h3>Live Meetings</h3>
                <p class="stat-number">{{ live_meetings }}</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon" style="background: #06b6d4;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></span>
            </div>
            <div class="stat-info">
                <h3>Cameras</h3>
                <p class="stat-number">{{ total_cameras }}</p>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="admin-section">
        <h2>Quick Actions</h2>
        <div class="action-buttons">
            <a href="{% url 'user_management' %}" class="action-btn" style="text-decoration: none;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></span>
                <p>Manage Users</p>
            </a>
            <a href="{% url 'admin_dashboard' %}" class="action-btn" style="text-decoration: none;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></span>
                <p>Manage Cameras</p>
            </a>
            <a href="{% url 'teacher_meetings' %}" class="action-btn" style="text-decoration: none;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></span>
                <p>View Meetings</p>
            </a>
            <a href="/admin/" class="action-btn" style="text-decoration: none;">
                <span class="icon icon-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M12 1v6m0 6v6m5.2-13.2l-4.2 4.2m0 6l4.2 4.2M23 12h-6m-6 0H1m18.2-5.2l-4.2 4.2m0 6l4.2 4.2"></path></svg></span>
                <p>Django Admin</p>
            </a>
        </div>
    </div>
    
    <!-- Recent Users -->
    <div class="admin-section">
        <h2>Recent Users</h2>
        <div class="users-table">
            <table>
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Type</th>
                        <th>Joined</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in recent_users %}
                    <tr>
                        <td><strong>{{ user.username }}</strong></td>
                        <td>{{ user.first_name }} {{ user.last_name }}</td>
                        <td>{{ user.email|default:"â€”" }}</td>
                        <td>
                            {% if user.userprofile %}
                            <span class="badge badge-{{ user.userprofile.user_type }}">{{ user.userprofile.get_user_type_display }}</span>
                            {% else %}
                            <span class="badge badge-admin">Admin</span>
                            {% endif %}
                        </td>
                        <td>{{ user.date_joined|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'profile_view' user.username %}" class="btn-small">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Recent Meetings -->
    <div class="admin-section">
        <h2>Recent Meetings</h2>
        <div class="meetings-list">
            {% for meeting in all_meetings %}
            <div class="meeting-card status-{{ meeting.status }}">
                <div class="meeting-header-info">
                    <h3>{{ meeting.title }}</h3>
                    <span class="meeting-status status-{{ meeting.status }}">{{ meeting.get_status_display }}</span>
                </div>
                
                <div class="meeting-details-grid">
                    <div class="detail-item-small">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></span>
                        <div>
                            <p class="label">Teacher</p>
                            <p class="value">{{ meeting.teacher.username }}</p>
                        </div>
                    </div>
                    
                    <div class="detail-item-small">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></span>
                        <div>
                            <p class="label">Scheduled</p>
                            <p class="value">{{ meeting.scheduled_time|date:"M d, h:i A" }}</p>
                        </div>
                    </div>
                    
                    <div class="detail-item-small">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"></path></svg></span>
                        <div>
                            <p class="label">Code</p>
                            <p class="value code">{{ meeting.meeting_code }}</p>
                        </div>
                    </div>
                    
                    <div class="detail-item-small">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></span>
                        <div>
                            <p class="label">Participants</p>
                            <p class="value">{{ meeting.participants.count }}</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
