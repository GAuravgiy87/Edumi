{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="profile-container">
    <div class="profile-header" data-role="{% if profile_user.is_superuser or profile_user.username == 'Admin' %}admin{% elif profile %}{{ profile.user_type }}{% endif %}">
        <div class="profile-cover"></div>
        <div class="profile-info-section">
            <div class="profile-avatar">
                {% if profile and profile.profile_picture and profile.profile_picture != 'https://ui-avatars.com/api/?name=User&background=1877f2&color=fff&size=200' %}
                <img src="{{ profile.profile_picture }}" alt="{{ profile_user.username }}" onerror="this.src='https://ui-avatars.com/api/?name={{ profile.get_display_name|urlencode }}&background=1877f2&color=fff&size=200'">
                {% else %}
                <img src="https://ui-avatars.com/api/?name={{ profile.get_display_name|urlencode }}&background=1877f2&color=fff&size=200&bold=true&font-size=0.4" alt="{{ profile_user.username }}">
                {% endif %}
            </div>
            <div class="profile-details">
                <h1>{{ profile.get_display_name }}</h1>
                <p class="profile-username">@{{ profile_user.username }}</p>
                {% if profile_user.is_superuser or profile_user.username == 'Admin' %}
                <span class="profile-badge badge-admin">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
                    Administrator
                </span>
                {% elif profile %}
                <span class="profile-badge badge-{{ profile.user_type }}">
                    {% if profile.user_type == 'teacher' %}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg>
                    {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                    {% endif %}
                    {{ profile.get_user_type_display }}
                </span>
                {% endif %}
            </div>
            {% if is_own_profile %}
            <div class="profile-actions">
                <a href="{% url 'edit_profile' %}" class="btn-edit-profile"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg></span> Edit Profile</a>
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="profile-content">
        <div class="profile-main">
            <!-- About Section -->
            <div class="profile-card">
                <h2>About</h2>
                {% if profile.bio %}
                <p class="profile-bio">{{ profile.bio }}</p>
                {% else %}
                <div class="empty-state">
                    <p class="empty-icon"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg></span></p>
                    <p class="empty-text">No bio added yet</p>
                    {% if is_own_profile %}
                    <a href="{% url 'edit_profile' %}" class="empty-action">Add Bio</a>
                    {% endif %}
                </div>
                {% endif %}
                
                {% if profile_user.email or profile.phone or profile.date_of_birth or profile.address %}
                <div class="profile-info-grid">
                    {% if profile_user.email %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></span>
                        <div>
                            <p class="label">Email</p>
                            <p class="value">{{ profile_user.email }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.phone %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg></span>
                        <div>
                            <p class="label">Phone</p>
                            <p class="value">{{ profile.phone }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.date_of_birth %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8"></path><path d="M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1"></path><path d="M2 21h20"></path></svg></span>
                        <div>
                            <p class="label">Date of Birth</p>
                            <p class="value">{{ profile.date_of_birth|date:"M d, Y" }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.address %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg></span>
                        <div>
                            <p class="label">Address</p>
                            <p class="value">{{ profile.address }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="empty-state">
                    <p class="empty-icon"><span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg></span></p>
                    <p class="empty-text">No contact information available</p>
                    {% if is_own_profile %}
                    <a href="{% url 'edit_profile' %}" class="empty-action">Add Information</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            
            <!-- Admin Specific Info -->
            {% if profile_user.is_superuser or profile_user.username == 'Admin' %}
            <div class="profile-card">
                <h2>Administrator Information</h2>
                <div class="profile-info-grid">
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg></span>
                        <div>
                            <p class="label">Total Users</p>
                            <p class="value">{{ stats.total_users|default:"0" }}</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><polyline points="17 2 12 7 7 2"></polyline></svg></span>
                        <div>
                            <p class="label">Total Meetings</p>
                            <p class="value">{{ stats.total_meetings|default:"0" }}</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg></span>
                        <div>
                            <p class="label">Live Meetings</p>
                            <p class="value">{{ stats.live_meetings|default:"0" }}</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect><rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect><line x1="6" y1="6" x2="6.01" y2="6"></line><line x1="6" y1="18" x2="6.01" y2="18"></line></svg></span>
                        <div>
                            <p class="label">Total Cameras</p>
                            <p class="value">{{ stats.total_cameras|default:"0" }}</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg></span>
                        <div>
                            <p class="label">Access Level</p>
                            <p class="value">Full Access</p>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg></span>
                        <div>
                            <p class="label">Role</p>
                            <p class="value">System Administrator</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Type Specific Info -->
            {% elif profile and profile.user_type == 'student' %}
            <div class="profile-card">
                <h2>Student Information</h2>
                <div class="profile-info-grid">
                    {% if profile.student_id %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2"></rect><circle cx="9" cy="10" r="2"></circle><path d="M15 8h2"></path><path d="M15 12h2"></path><path d="M7 16h10"></path></svg></span>
                        <div>
                            <p class="label">Student ID</p>
                            <p class="value">{{ profile.student_id }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.grade %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg></span>
                        <div>
                            <p class="label">Grade</p>
                            <p class="value">{{ profile.grade }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.enrollment_date %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></span>
                        <div>
                            <p class="label">Enrollment Date</p>
                            <p class="value">{{ profile.enrollment_date|date:"M d, Y" }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% elif profile.user_type == 'teacher' %}
            <div class="profile-card">
                <h2>Teacher Information</h2>
                <div class="profile-info-grid">
                    {% if profile.employee_id %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="16" rx="2"></rect><circle cx="9" cy="10" r="2"></circle><path d="M15 8h2"></path><path d="M15 12h2"></path><path d="M7 16h10"></path></svg></span>
                        <div>
                            <p class="label">Employee ID</p>
                            <p class="value">{{ profile.employee_id }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.department %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><path d="M9 22v-4h6v4"></path><path d="M8 6h.01"></path><path d="M16 6h.01"></path><path d="M12 6h.01"></path></svg></span>
                        <div>
                            <p class="label">Department</p>
                            <p class="value">{{ profile.department }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.specialization %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path></svg></span>
                        <div>
                            <p class="label">Specialization</p>
                            <p class="value">{{ profile.specialization }}</p>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if profile.join_date %}
                    <div class="info-item">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg></span>
                        <div>
                            <p class="label">Join Date</p>
                            <p class="value">{{ profile.join_date|date:"M d, Y" }}</p>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Social Links -->
            {% if profile.linkedin or profile.twitter or profile.website %}
            <div class="profile-card">
                <h2>Social Links</h2>
                <div class="social-links">
                    {% if profile.linkedin %}
                    <a href="{{ profile.linkedin }}" target="_blank" class="social-link">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg></span>
                        <span>LinkedIn</span>
                    </a>
                    {% endif %}
                    
                    {% if profile.twitter %}
                    <a href="{{ profile.twitter }}" target="_blank" class="social-link">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></span>
                        <span>Twitter</span>
                    </a>
                    {% endif %}
                    
                    {% if profile.website %}
                    <a href="{{ profile.website }}" target="_blank" class="social-link">
                        <span class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg></span>
                        <span>Website</span>
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="profile-sidebar">
            <!-- Profile Completion -->
            {% if is_own_profile %}
            <div class="profile-card">
                <h2>Profile Completion</h2>
                <div class="completion-indicator">
                    <div class="completion-bar">
                        <div class="completion-fill" style="width: {{ completion }}%"></div>
                    </div>
                    <p class="completion-text">{{ completion }}% Complete</p>
                    {% if completion < 100 %}
                    <a href="{% url 'edit_profile' %}" class="completion-action">Complete Your Profile</a>
                    {% else %}
                    <p class="completion-success">âœ“ Profile Complete!</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            <!-- Statistics -->
            <div class="profile-card">
                <h2>Statistics</h2>
                <div class="stats-list">
                    {% if profile.user_type == 'teacher' %}
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.total_meetings }}</span>
                        <span class="stat-label">Total Meetings</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.live_meetings }}</span>
                        <span class="stat-label">Live Now</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.completed_meetings }}</span>
                        <span class="stat-label">Completed</span>
                    </div>
                    {% elif profile.user_type == 'student' %}
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.enrolled_courses }}</span>
                        <span class="stat-label">Enrolled Courses</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.completed_assignments }}</span>
                        <span class="stat-label">Completed</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">{{ stats.meetings_attended }}</span>
                        <span class="stat-label">Meetings Attended</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Member Since -->
            <div class="profile-card">
                <h2>Member Since</h2>
                <p class="member-since">{{ profile_user.date_joined|date:"F Y" }}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
