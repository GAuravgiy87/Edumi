{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="test-container">
    <h1>Mobile Camera Feed Test</h1>
    <h2>{{ mobile_camera.name }}</h2>
    
    <div class="test-info">
        <h3>Connection Details:</h3>
        <p><strong>Direct Stream URL:</strong> {{ stream_url }}</p>
        <p><strong>Camera Service URL:</strong> {{ camera_service_url }}</p>
        
        {% if success %}
        <div class="success-box">
            <p>‚úì Connection Successful via Camera Service!</p>
            <p><strong>Status:</strong> {{ status }}</p>
            <p><strong>Message:</strong> {{ message }}</p>
        </div>
        
        <h3>Live Feed Test (via Camera Service on port 8001):</h3>
        <div class="feed-test">
            <img src="{% url 'mobile_cameras:feed' mobile_camera.id %}" alt="Camera Feed" style="max-width: 100%; border: 2px solid #28a745;">
        </div>
        
        <h3>Architecture:</h3>
        <div class="architecture-info">
            <p>üì± Mobile Camera ({{ mobile_camera.ip_address }}:{{ mobile_camera.port }}) ‚Üí üîß Camera Service (port 8001) ‚Üí üåê Main App (port 8000) ‚Üí üë§ You</p>
            <p>All camera streaming is handled by the dedicated camera service for optimal performance.</p>
        </div>
        
        {% else %}
        <div class="error-box">
            <p>‚úó Connection Failed</p>
            {% if error %}
            <p><strong>Error:</strong> {{ error }}</p>
            {% endif %}
        </div>
        
        <h3>Troubleshooting:</h3>
        <ul>
            <li><strong>Camera Service:</strong> Ensure camera service is running on port 8001 (run start_services.bat)</li>
            <li><strong>Network:</strong> Ensure your phone and server are on the same WiFi network</li>
            <li><strong>IP Address:</strong> Check if {{ mobile_camera.ip_address }} is correct</li>
            <li><strong>Camera App:</strong> Verify the camera app is running on your phone</li>
            <li><strong>Direct Test:</strong> Try accessing the stream URL directly: <a href="{{ stream_url }}" target="_blank">{{ stream_url }}</a></li>
            <li><strong>Firewall:</strong> Check if firewall is blocking the connection</li>
        </ul>
        {% endif %}
    </div>
    
    <div class="actions">
        <a href="{% url 'mobile_cameras:dashboard' %}" class="btn">Back to Dashboard</a>
        <button onclick="location.reload()" class="btn btn-primary">Retry Test</button>
    </div>
</div>

<style>
.test-container {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.test-container h1 {
    color: #212529;
    margin-bottom: 0.5rem;
}

.test-container h2 {
    color: #6c757d;
    font-size: 1.5rem;
    margin-bottom: 2rem;
}

.test-container h3 {
    color: #212529;
    font-size: 1.2rem;
    margin-top: 2rem;
    margin-bottom: 1rem;
}

.test-info {
    margin: 2rem 0;
}

.test-info p {
    margin: 0.5rem 0;
}

.success-box {
    background: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
}

.error-box {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
}

.architecture-info {
    background: #e7f3ff;
    border: 1px solid #b3d9ff;
    color: #004085;
    padding: 1.5rem;
    border-radius: 8px;
    margin: 1rem 0;
}

.feed-test {
    margin: 1rem 0;
    background: #000;
    padding: 1rem;
    border-radius: 8px;
}

pre {
    background: #f8f9fa;
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    font-size: 0.875rem;
}

.actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    cursor: pointer;
    border: none;
    background: #6c757d;
    color: white;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.btn:hover {
    opacity: 0.9;
}

ul {
    margin: 1rem 0;
    padding-left: 2rem;
}

ul li {
    margin: 0.5rem 0;
}
</style>
{% endblock %}
